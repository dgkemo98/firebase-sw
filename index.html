<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ§ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª DGKemo</title>
</head>
<body style="background:#000;color:#ffd700;font-family:Tahoma;text-align:center;padding:40px;">

  <h1>ğŸ§ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª DGKemo</h1>
  <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØªÙ†Ø¨ÙŠÙ‡Ùƒ Ø¹Ù†Ø¯ Ù†Ø²ÙˆÙ„ Ø£ØºÙ†ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© ğŸ””</p>

  <button id="enableBtn" style="padding:10px 20px;background:#ffd700;border:none;color:#000;font-size:18px;border-radius:10px;cursor:pointer;">
    ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  </button>

  <div id="status" style="margin-top:20px;line-height:1.4;"></div>

  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.3.0/firebase-messaging-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBOyIGeCHOPAnBFYZ8wZZ2PYrfZXU9nIDU",
      authDomain: "dgkemo-52c93.firebaseapp.com",
      databaseURL: "https://dgkemo-52c93-default-rtdb.firebaseio.com",
      projectId: "dgkemo-52c93",
      storageBucket: "dgkemo-52c93.firebasestorage.app",
      messagingSenderId: "542241001900",
      appId: "1:542241001900:web:ab2de6b9a43a4322336a09",
      measurementId: "G-96BMQDSMXK"
    };
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    const SW_URL = './firebase-messaging-sw.js';
    const statusEl = document.getElementById('status');
    const btn = document.getElementById('enableBtn');

    function showStatus(html, isError = false) {
      statusEl.innerHTML = html;
      statusEl.style.color = isError ? '#ff7070' : '#ffd700';
    }

    function escapeHtml(unsafe) {
      return String(unsafe).replace(/[&<>"'`=\/]/g, s =>
        ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;' }[s]));
    }

    btn.addEventListener('click', async () => {
      btn.disabled = true;
      showStatus('â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚...');

      try {
        if (!('serviceWorker' in navigator)) throw new Error('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Service Workers.');
        if (!('Notification' in window)) throw new Error('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Notifications.');

        const res = await fetch(SW_URL, { method: 'HEAD' });
        if (!res.ok) throw new Error(`Ù…Ù„Ù Service Worker ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ (${res.status}).`);

        const reg = await navigator.serviceWorker.register(SW_URL);
        messaging.useServiceWorker?.(reg);

        const permission = await Notification.requestPermission();
        if (permission !== 'granted') {
          showStatus('âš ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù† Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.');
          btn.disabled = false;
          return;
        }

        // âœ… Ù‡Ù†Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù…Ø³Ø§ÙØ§Øª Ø£Ùˆ ØªØ§Ø¨
        const VAPID_KEY = "BOT23GIP27I7OV_g-iT_tcQlq6kpdz-Ew6UpaZvEiVIXBjbvre6Ma2xURI10Qs5GfF3RVQ7X1ZZfZWMs6kqrX0w";

        const token = await messaging.getToken({ vapidKey: VAPID_KEY });
        if (!token) throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ token. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ØµÙØ­Ø© HTTPS.');

        showStatus(`âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!<br><textarea style="width:100%;height:80px;">${escapeHtml(token)}</textarea>`);
        console.log('FCM Token:', token);

      } catch (err) {
        console.error(err);
        showStatus('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„: ' + escapeHtml(err.message || err), true);
      } finally {
        btn.disabled = false;
      }
    });

    messaging.onMessage(payload => {
      console.log("ğŸ“© Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯:", payload);
      new Notification(payload.notification?.title || "ğŸµ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯", {
        body: payload.notification?.body || "ØªÙ… Ù†Ø´Ø± Ø£ØºÙ†ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©!"
      });
    });
  </script>
</body>
</html>
